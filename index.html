<!DOCTYPE html>
<html lang="tr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>Oxford 3000 Pro - Modern Edition</title>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
Â  Â Â 
Â  Â  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

Â  Â  <style>
Â  Â  Â  Â  :root { --primary: #4f46e5; --primary-light: #818cf8; --success: #10b981; --expert: #059669; --warning: #f59e0b; --error: #ef4444; --bg: #f1f5f9; --text: #0f172a; --card: #ffffff; }
Â  Â  Â  Â  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
Â  Â  Â  Â  body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; color: var(--text); overflow-x: hidden; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Glassmorphism Container */
Â  Â  Â  Â  .container { background: var(--card); width: 100%; max-width: 480px; min-height: 100vh; padding: 24px; position: relative; display: flex; flex-direction: column; transition: all 0.3s ease; }
Â  Â  Â  Â  @media (min-width: 500px) { .container { min-height: auto; border-radius: 32px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.1); margin: 20px; } }

Â  Â  Â  Â  /* User Overlay - Full Screen Blur */
Â  Â  Â  Â  #user-overlay { position: fixed; inset: 0; background: rgba(241, 245, 249, 0.95); backdrop-filter: blur(12px); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; }
Â  Â  Â  Â  .user-card { background: white; width: 100%; max-width: 320px; padding: 18px; margin: 10px 0; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border: 1px solid #e2e8f0; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
Â  Â  Â  Â  .user-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .del-user { color: var(--error); font-weight: 800; padding: 8px; font-size: 0.8rem; background: #fee2e2; border-radius: 10px; }

Â  Â  Â  Â  /* Google Login Button Style */
Â  Â  Â  Â  .google-btn { background: white; color: var(--text); border: 1px solid #e2e8f0; padding: 15px; border-radius: 20px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 320px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.2s; }
Â  Â  Â  Â  .google-btn:hover { background: #f8fafc; transform: translateY(-1px); }

Â  Â  Â  Â /* Modern Menu Bar */

Â  Â  Â  Â  .menu-bar { display: flex; justify-content: space-around; align-items: center; margin-bottom: 20px; background: #f8fafc; border-radius: 20px; padding: 8px; border: 1px solid #f1f5f9; flex-wrap: nowrap; }
Â  Â  Â  Â  .menu-item { font-size: 0.6rem; font-weight: 800; cursor: pointer; color: #64748b; padding: 10px 14px; border-radius: 14px; transition: all 0.2s; display: flex; align-items: center; gap: 5px; }
Â  Â  Â  Â  .active-user { color: var(--primary); background: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Filter Panel Responsive */
Â  Â  Â  Â  .filter-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 24px; }
Â  Â  Â  Â  select { appearance: none; background: #f1f5f9; border: 2px solid transparent; padding: 12px; border-radius: 16px; font-weight: 600; font-size: 0.85rem; color: #475569; outline: none; cursor: pointer; transition: border 0.2s; }
Â  Â  Â  Â  select:focus { border-color: var(--primary-light); background: white; }

Â  Â  Â  Â  /* Word Presentation Area */
Â  Â  Â  Â  #target-word { font-size: 3.2rem; font-weight: 800; margin: 0px 0 10px 0; color: #1e293b; letter-spacing: -1.5px; line-height: 1.1; min-height: 80px; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.4s ease; }
Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .tags-container { display: flex; justify-content: center; gap: 8px; margin-bottom: 10px; }
Â  Â  Â  Â  .tag { padding: 6px 14px; border-radius: 12px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
Â  Â  Â  Â  .tag-lvl { background: #e0e7ff; color: #4338ca; }
Â  Â  Â  Â  .tag-info { background: #fef3c7; color: #92400e; }

Â  Â  Â  Â  /* Input & Interaction */
Â  Â  Â  Â  .input-group { position: relative; margin-top: auto; }
Â  Â  Â  Â  input { width: 100%; padding: 20px; border: 2px solid #e2e8f0; border-radius: 20px; font-size: 1.1rem; font-weight: 600; outline: none; text-align: center; transition: all 0.3s; background: #f8fafc; }
Â  Â  Â  Â  input:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #action-btn { width: 100%; padding: 20px; border: none; border-radius: 20px; background: var(--primary); color: white; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-top: 16px; transition: all 0.3s; box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3); }
Â  Â  Â  Â  #action-btn:active { transform: scale(0.98); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; border-color: var(--warning) !important; }
Â  Â  Â  Â  @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

Â  Â  Â  Â  /* Modals Modern */
Â  Â  Â  Â  .modal { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(8px); z-index: 3000; align-items: center; justify-content: center; padding: 20px; }
Â  Â  Â  Â  .modal-content { background: white; width: 100%; max-width: 400px; border-radius: 28px; padding: 28px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); position: relative; max-height: 80vh; overflow-y: auto; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Stats Visuals */
Â  Â  Â  Â  .progress-row { margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 18px; border: 1px solid #f1f5f9; }
Â  Â  Â  Â  .progress-bar { background: #e2e8f0; height: 12px; border-radius: 6px; overflow: hidden; margin: 8px 0; }
Â  Â  Â  Â  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary-light), var(--primary)); transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); }
Â  Â  Â  Â  .expert-fill { height: 100%; background: linear-gradient(90deg, var(--success), var(--expert)); transition: width 0.8s; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #feedback { font-weight: 700; margin-bottom: 10px; font-size: 1rem; transition: all 0.2s; }
Â  Â  </style>
</head>
<body>

<div id="user-overlay">
Â  Â  <div style="text-align:center; margin-bottom:30px">
Â  Â  Â  Â  <h1 style="font-weight:800; font-size:2rem; margin:0; letter-spacing:-1px">Oxford 3000<span style="color:var(--primary)">.</span></h1>
Â  Â  Â  Â  <p style="color:#64748b; font-weight:600">Ã–ÄŸrenme yolculuÄŸuna baÅŸla</p>
Â  Â  </div>

Â  Â  <button class="google-btn" onclick="loginWithGoogle()">
Â  Â  Â  Â  <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18">
Â  Â  Â  Â  Google ile GiriÅŸ Yap
Â  Â  </button>
Â  Â  <div style="color:#cbd5e1; font-size:0.8rem; margin-bottom:15px;">â€” VEYA YEREL DEVAM ET â€”</div>

Â  Â  <div id="user-list" style="width:100%; display:flex; flex-direction:column; align-items:center; max-height:30vh; overflow-y:auto; padding:10px"></div>
Â  Â  <div style="width:100%; max-width:320px; margin-top:20px; padding-top:20px; border-top:2px solid #e2e8f0">
Â  Â  Â  Â  <input type="text" id="new-username" placeholder="Yeni Ã–ÄŸrenci Ä°smi" style="font-size:0.95rem; padding:15px; background:white">
Â  Â  Â  Â  <button onclick="createUser()" style="width:100%; margin-top:12px; padding:15px; border-radius:18px; background:var(--text); color:white; border:none; font-weight:700; cursor:pointer">PROFÄ°L OLUÅTUR</button>
Â  Â  </div>
</div>

<div class="container">
Â  Â  <div class="menu-bar">
Â  Â  Â  Â  <div id="active-user-name" class="menu-item active-user" onclick="location.reload()">ğŸ‘¤ Profil</div>
Â  Â  Â  Â  <div class="menu-item" onclick="toggleModal('mistake-modal', true)">âš ï¸ HATALAR <span id="wrong-count" style="margin-left:4px">0</span></div>
Â  Â  Â  Â  <div class="menu-item" onclick="openStats()">ğŸ“Š KELÄ°METÄ°STÄ°K</div>
Â  Â  </div>

Â  Â  <div class="filter-panel">
Â  Â  Â  Â  <select id="level-filter" onchange="applyFilters()"><option value="ALL">Seviye: TÃ¼mÃ¼</option><option value="A1">Seviye A1</option><option value="A2">Seviye A2</option><option value="B1">Seviye B1</option><option value="B2">Seviye B2</option><option value="C1">Seviye C1</option></select>
Â  Â  Â  Â  <select id="type-filter" onchange="applyFilters()"><option value="ALL">TÃ¼r: TÃ¼mÃ¼</option><option value="v.">Fiiller (v.)</option><option value="n.">Ä°simler (n.)</option><option value="adj.">SÄ±fatlar (adj.)</option><option value="adv.">Zarflar (adv.)</option></select>
Â  Â  </div>

Â  Â  <div class="tags-container" id="tags-box"></div>
Â  Â  <div onclick="speakWord()" style="cursor:pointer; margin-bottom:20px">
Â  Â  Â  Â  <div id="target-word">...</div>
Â  Â  Â  Â  <div style="font-size: 0.75rem; color: var(--primary); font-weight: 800; letter-spacing: 1px; text-align:center">ğŸ”Š TELAFFUZU DÄ°NLE</div>
Â  Â  </div>

Â  Â  <div class="input-group">
Â  Â  Â  Â  <div id="feedback"></div>
Â  Â  Â  Â  <input type="text" id="user-input" placeholder="TÃ¼rkÃ§e karÅŸÄ±lÄ±ÄŸÄ±nÄ± yaz..." autocomplete="off">
Â  Â  Â  Â  <button id="action-btn">KONTROL ET</button>
Â  Â  </div>
</div>

<div id="stats-modal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <h2 style="font-weight:800; margin-bottom:20px">GeliÅŸim Analizi</h2>
Â  Â  Â  Â  <div style="position:relative; margin-bottom:20px">
Â  Â  Â  Â  Â  Â  <canvas id="statsChart" style="max-height:160px;"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="level-bars"></div>
Â  Â  Â  Â  <button onclick="toggleModal('stats-modal', false)" style="width:100%; margin-top:10px; padding:15px; border-radius:16px; border:none; background:#f1f5f9; color:var(--text); font-weight:700; cursor:pointer">KAPAT</button>
Â  Â  </div>
</div>

<div id="mistake-modal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <h2 style="font-weight:800; margin-bottom:20px">HatalÄ± Kelimeler</h2>
Â  Â  Â  Â  <div id="mistake-list-container" style="max-height:50vh; overflow-y:auto"></div>
Â  Â  Â  Â  <button onclick="toggleModal('mistake-modal', false)" style="width:100%; margin-top:20px; padding:15px; border-radius:16px; border:none; background:#f1f5f9; color:var(--text); font-weight:700">KAPAT</button>
Â  Â  </div>
</div>

<script>
Â  Â  // --- FIREBASE CONFIG ---
Â  Â  const firebaseConfig = {
Â  Â  Â  Â  apiKey: "AIzaSyCM5M27q4r-gxhkQoc1XEyGU7JCI1Nzk5M",
Â  Â  Â  Â  authDomain: "kelimelik-43169.firebaseapp.com",
Â  Â  Â  Â  projectId: "kelimelik-43169",
Â  Â  Â  Â  storageBucket: "kelimelik-43169.firebasestorage.app",
Â  Â  Â  Â  messagingSenderId: "1065593596358",
Â  Â  Â  Â  appId: "1:1065593596358:web:d34ad0df91fd9efd252ac7"
Â  Â  };
Â  Â  firebase.initializeApp(firebaseConfig);
Â  Â  const auth = firebase.auth();
Â  Â  const db = firebase.firestore();

Â  Â  // --- APP LOGIC ---
Â  Â  let masterDict = [];
Â  Â  let users = JSON.parse(localStorage.getItem('ox_users')) || [];
Â  Â  let currentUser = null;
Â  Â  let srsData = {};
Â  Â  let filteredDict = [];
Â  Â  let currentItem = null, myChart = null, secondChanceActive = false;
Â  Â  const levels = ['A1', 'A2', 'B1', 'B2', 'C1'], types = ['v.', 'n.', 'adj.', 'adv.'];

Â  Â  function initUserSystem() {
Â  Â  Â  Â  const list = document.getElementById('user-list');
Â  Â  Â  Â  list.innerHTML = "";
Â  Â  Â  Â  users.forEach(u => {
Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  div.className = 'user-card';
Â  Â  Â  Â  Â  Â  div.innerHTML = `<span onclick="selectUser('${u}')" style="flex:1; font-weight:700;">${u}</span><span class="del-user" onclick="deleteUser('${u}')">SÄ°L</span>`;
Â  Â  Â  Â  Â  Â  list.appendChild(div);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  async function loginWithGoogle() {
Â  Â  Â  Â  const provider = new firebase.auth.GoogleAuthProvider();
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const result = await auth.signInWithPopup(provider);
Â  Â  Â  Â  Â  Â  const user = result.user;
Â  Â  Â  Â  Â  Â  currentUser = user.displayName;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Buluttan veriyi getir
Â  Â  Â  Â  Â  Â  const doc = await db.collection("users").doc(user.uid).get();
Â  Â  Â  Â  Â  Â  srsData = doc.exists ? (doc.data().srsData || {}) : {};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ArayÃ¼zÃ¼ gÃ¼ncelle
Â  Â  Â  Â  Â  Â  document.getElementById('user-overlay').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('active-user-name').innerText = "ğŸ‘¤ " + currentUser;
Â  Â  Â  Â  Â  Â  loadCSV();
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  Â  Â  alert("Google ile giriÅŸ baÅŸarÄ±sÄ±z.");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function createUser() {
Â  Â  Â  Â  const name = document.getElementById('new-username').value.trim();
Â  Â  Â  Â  if(!name || users.includes(name)) return alert("GeÃ§ersiz isim!");
Â  Â  Â  Â  users.push(name);
Â  Â  Â  Â  localStorage.setItem('ox_users', JSON.stringify(users));
Â  Â  Â  Â  document.getElementById('new-username').value = "";
Â  Â  Â  Â  initUserSystem();
Â  Â  }

Â  Â  function deleteUser(name) {
Â  Â  Â  Â  if(!confirm(name + " silinsin mi?")) return;
Â  Â  Â  Â  users = users.filter(u => u !== name);
Â  Â  Â  Â  localStorage.removeItem('ox_srs_' + name);
Â  Â  Â  Â  localStorage.setItem('ox_users', JSON.stringify(users));
Â  Â  Â  Â  initUserSystem();
Â  Â  }

Â  Â  function selectUser(name) {
Â  Â  Â  Â  currentUser = name;
Â  Â  Â  Â  const savedData = localStorage.getItem('ox_srs_' + name);
Â  Â  Â  Â  srsData = savedData ? JSON.parse(savedData) : {};
Â  Â  Â  Â  document.getElementById('user-overlay').style.display = 'none';
Â  Â  Â  Â  document.getElementById('active-user-name').innerText = "ğŸ‘¤ " + name;
Â  Â  Â  Â  loadCSV();
Â  Â  }

Â  Â  async function loadCSV() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch('kelimeler.csv');
Â  Â  Â  Â  Â  Â  const data = await res.text();
Â  Â  Â  Â  Â  Â  const rows = data.split('\n').slice(1);
Â  Â  Â  Â  Â  Â  let fileWords = [];
Â  Â  Â  Â  Â  Â  rows.forEach(row => {
Â  Â  Â  Â  Â  Â  Â  Â  const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.trim().replace(/^"|"$/g, ''));
Â  Â  Â  Â  Â  Â  Â  Â  if(cols[0] && cols[cols.length-1]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileWords.push({ eng: cols[0], tr: cols[cols.length-1], level: cols.find(c => levels.includes(c.toUpperCase())) || "A1", types: [cols.find(c => types.includes(c.toLowerCase())) || "n."] });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  masterDict = [...fileWords];
Â  Â  Â  Â  Â  Â  applyFilters();
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  } catch (e) { console.error("CSV yÃ¼klenemedi."); }
Â  Â  }

Â  Â  function applyFilters() {
Â  Â  Â  Â  const sL = document.getElementById('level-filter').value;
Â  Â  Â  Â  const sT = document.getElementById('type-filter').value;
Â  Â  Â  Â  filteredDict = masterDict.filter(i => (sL === "ALL" || i.level === sL) && (sT === "ALL" || i.types.includes(sT)));
Â  Â  Â  Â  getNextWord();
Â  Â  }

Â  Â  function getNextWord() {
Â  Â  Â  Â  if (!filteredDict.length) return document.getElementById('target-word').innerText = "Liste BoÅŸ";
Â  Â  Â  Â  secondChanceActive = false;
Â  Â  Â  Â  const mists = filteredDict.filter(i => srsData[i.eng]?.isMistake);
Â  Â  Â  Â  currentItem = (mists.length > 0 && Math.random() < 0.3) ? mists[Math.floor(Math.random() * mists.length)] : filteredDict[Math.floor(Math.random() * filteredDict.length)];
Â  Â  Â  Â  renderWord();
Â  Â  }

Â  Â  function renderWord() {
Â  Â  Â  Â  document.getElementById('target-word').innerText = currentItem.eng;
Â  Â  Â  Â  document.getElementById('tags-box').innerHTML = `<span class="tag tag-lvl">${currentItem.level}</span><span class="tag tag-info">${currentItem.types[0]}</span>`;
Â  Â  Â  Â  const inp = document.getElementById('user-input');
Â  Â  Â  Â  inp.value = ""; inp.disabled = false; inp.focus(); inp.classList.remove('shake');
Â  Â  Â  Â  document.getElementById('action-btn').innerText = "KONTROL ET";
Â  Â  Â  Â  document.getElementById('action-btn').style.background = "var(--primary)";
Â  Â  Â  Â  document.getElementById('action-btn').onclick = checkAnswer;
Â  Â  Â  Â  document.getElementById('feedback').innerText = "";
Â  Â  }

Â  Â  function checkAnswer() {
Â  Â  Â  Â  const val = document.getElementById('user-input').value.trim().toLowerCase();
Â  Â  Â  Â  const ans = currentItem.tr.toLowerCase().split(',').map(a => a.trim());
Â  Â  Â  Â  const fb = document.getElementById('feedback');
Â  Â  Â  Â  if (ans.includes(val)) {
Â  Â  Â  Â  Â  Â  fb.innerText = "âœ¨ HARÄ°KA!"; fb.style.color = "var(--success)";
Â  Â  Â  Â  Â  Â  if (!srsData[currentItem.eng]) srsData[currentItem.eng] = { level: 0, isMistake: false };
Â  Â  Â  Â  Â  Â  srsData[currentItem.eng].level++;Â 
Â  Â  Â  Â  Â  Â  srsData[currentItem.eng].isMistake = false;
Â  Â  Â  Â  Â  Â  finalizeRound(true);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if (!secondChanceActive) {
Â  Â  Â  Â  Â  Â  Â  Â  fb.innerText = "ğŸ¯ Tekrar dene!"; fb.style.color = "var(--warning)";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-input').classList.add('shake'); secondChanceActive = true;
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => document.getElementById('user-input').classList.remove('shake'), 400);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  fb.innerText = `ğŸ’¡ Cevap: ${currentItem.tr}`; fb.style.color = "var(--error)";
Â  Â  Â  Â  Â  Â  Â  Â  if (!srsData[currentItem.eng]) srsData[currentItem.eng] = { level: 0, isMistake: false };
Â  Â  Â  Â  Â  Â  Â  Â  srsData[currentItem.eng].isMistake = true;
Â  Â  Â  Â  Â  Â  Â  Â  finalizeRound(false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function finalizeRound(isCorrect) {
Â  Â  Â  Â  // Yerel KayÄ±t
Â  Â  Â  Â  localStorage.setItem('ox_srs_' + currentUser, JSON.stringify(srsData));
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Google ile girilmiÅŸse Bulut KaydÄ±
Â  Â  Â  Â  if (auth.currentUser) {
Â  Â  Â  Â  Â  Â  db.collection("users").doc(auth.currentUser.uid).set({
Â  Â  Â  Â  Â  Â  Â  Â  srsData: srsData,
Â  Â  Â  Â  Â  Â  Â  Â  lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
Â  Â  Â  Â  Â  Â  }, { merge: true });
Â  Â  Â  Â  }

Â  Â  Â updateUI();
Â  Â Â 
Â  Â  const actionBtn = document.getElementById('action-btn');
Â  Â  const userInput = document.getElementById('user-input');

Â  Â  userInput.disabled = true;
Â  Â  actionBtn.innerText = "SIRADAKÄ°";
Â  Â  actionBtn.style.background = isCorrect ? "var(--success)" : "var(--error)";
Â  Â  actionBtn.onclick = getNextWord;

Â  Â  // --- OTOMATÄ°K GEÃ‡Ä°Å MANTIÄI ---
Â  Â  // EÄŸer doÄŸruysa 1 saniye bekle, yanlÄ±ÅŸsa cevabÄ± gÃ¶rmesi iÃ§in 3 saniye bekle
Â  Â  const delay = isCorrect ? 1000 : 3000;

Â  Â  // Mevcut bir otomatik geÃ§iÅŸi iptal etmek iÃ§in (Ã¼st Ã¼ste binmemesi iÃ§in)
Â  Â  if (window.autoNextTimeout) clearTimeout(window.autoNextTimeout);

Â  Â  window.autoNextTimeout = setTimeout(() => {
Â  Â  Â  Â  // EÄŸer kullanÄ±cÄ± zaten manuel olarak 'SÄ±radaki'ne basmadÄ±ysa geÃ§
Â  Â  Â  Â  if (userInput.disabled) {Â 
Â  Â  Â  Â  Â  Â  getNextWord();
Â  Â  Â  Â  }
Â  Â  }, delay);
}

Â  Â  function updateUI() {
Â  Â  Â  Â  const mCount = Object.values(srsData).filter(v => v.isMistake).length;
Â  Â  Â  Â  document.getElementById('wrong-count').innerText = mCount;
Â  Â  Â  Â  const mList = masterDict.filter(i => srsData[i.eng]?.isMistake);
Â  Â  Â  Â  document.getElementById('mistake-list-container').innerHTML = mList.map(m => `<div style="padding:15px; border-bottom:1px solid #f1f5f9; display:flex; justify-content:space-between"><b>${m.eng}</b> <span style="color:#64748b">${m.tr}</span></div>`).join('');
Â  Â  }

Â  Â  function openStats() {
Â  Â  Â  Â  toggleModal('stats-modal', true);
Â  Â  Â  Â  const data = Object.values(srsData);
Â  Â  Â  Â  const stats = { new: masterDict.length - data.length, learn: data.filter(v => v.level > 0 && v.level < 4 && !v.isMistake).length, exp: data.filter(v => v.level >= 4).length, mist: data.filter(v => v.isMistake).length };
Â  Â  Â  Â  const ctx = document.getElementById('statsChart').getContext('2d');
Â  Â  Â  Â  if(myChart) myChart.destroy();
Â  Â  Â  Â  myChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Yeni', 'Ã–ÄŸreniliyor', 'Uzman', 'HatalÄ±'], datasets: [{ data: [stats.new, stats.learn, stats.exp, stats.mist], backgroundColor: ['#e2e8f0','#4f46e5','#10b981','#ef4444'], borderWeight:0 }] }, options: { plugins: { legend: { display: false } }, cutout: '75%', borderRadius: 10 } });
Â  Â  Â  Â  let h = "";
Â  Â  Â  Â  levels.forEach(l => {
Â  Â  Â  Â  Â  Â  const total = masterDict.filter(i => i.level === l).length;
Â  Â  Â  Â  Â  Â  const lr = masterDict.filter(i => i.level === l && srsData[i.eng]?.level > 0).length;
Â  Â  Â  Â  Â  Â  const ex = masterDict.filter(i => i.level === l && srsData[i.eng]?.level >= 4).length;
Â  Â  Â  Â  Â  Â  const pL = total > 0 ? Math.round((lr/total)*100) : 0;
Â  Â  Â  Â  Â  Â  const pE = total > 0 ? Math.round((ex/total)*100) : 0;
Â  Â  Â  Â  Â  Â  h += `<div class="progress-row"><div style="display:flex; justify-content:space-between; font-size:0.75rem; font-weight:800; margin-bottom:5px"><span>${l} Seviyesi</span><span>${lr}/${total}</span></div><div class="progress-bar"><div class="progress-fill" style="width:${pL}%"></div></div><div style="display:flex; justify-content:space-between; font-size:0.65rem; color:var(--expert); font-weight:800;"><span>UzmanlÄ±k Derecesi</span><span>%${pE}</span></div><div class="progress-bar" style="height:6px"><div class="expert-fill" style="width:${pE}%"></div></div></div>`;
Â  Â  Â  Â  });
Â  Â  Â  Â  document.getElementById('level-bars').innerHTML = h;
Â  Â  }

Â  Â  function speakWord() { window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(currentItem.eng); u.lang = 'en-US'; u.rate = 0.85; window.speechSynthesis.speak(u); }
Â  Â  function toggleModal(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }
Â  Â  document.getElementById('user-input').addEventListener("keypress", (e) => { if(e.key === "Enter") document.getElementById('action-btn').click(); });
Â  Â  window.onload = initUserSystem;
const settingsHTML = `
<div id="settings-modal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <h2 style="font-weight:800; margin-bottom:20px">Ayarlar</h2>
Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; padding:15px; background:#f8fafc; border-radius:18px; margin-bottom:20px">
Â  Â  Â  Â  Â  Â  <span style="font-weight:600">Otomatik Ses (Ä°ngilizce)</span>
Â  Â  Â  Â  Â  Â  <label class="switch">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="auto-speak-toggle" onchange="toggleAutoSpeak(this.checked)">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="slider"></span>
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button onclick="toggleModal('settings-modal', false)" style="width:100%; padding:15px; border-radius:16px; border:none; background:var(--primary); color:white; font-weight:700; cursor:pointer">KAYDET VE KAPAT</button>
Â  Â  </div>
</div>

<style>
/* Toggle Switch TasarÄ±mÄ± */
.switch { position: relative; display: inline-block; width: 50px; height: 26px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; inset: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--success); }
input:checked + .slider:before { transform: translateX(24px); }
</style>
`;
document.body.insertAdjacentHTML('beforeend', settingsHTML);
const menuBar = document.querySelector('.menu-bar');
const settingsBtn = document.createElement('div');
settingsBtn.className = 'menu-item';
settingsBtn.innerHTML = 'âš™ï¸ AYARLAR';
settingsBtn.onclick = () => toggleModal('settings-modal', true);
menuBar.appendChild(settingsBtn);
let autoSpeakEnabled = localStorage.getItem('ox_auto_speak') === 'true';
document.getElementById('auto-speak-toggle').checked = autoSpeakEnabled;

function toggleAutoSpeak(isEnabled) {
Â  Â  autoSpeakEnabled = isEnabled;
Â  Â  localStorage.setItem('ox_auto_speak', isEnabled);
}
const originalRenderWord = renderWord;
renderWord = function() {
Â  Â  originalRenderWord(); // Eski renderWord fonksiyonunu Ã§alÄ±ÅŸtÄ±r
Â  Â  if (autoSpeakEnabled && currentItem) {
Â  Â  Â  Â  setTimeout(() => speakWord(), 300);
Â  Â  }
};
window.speakWord = function() {
Â  Â  window.speechSynthesis.cancel();
Â  Â  const utterance = new SpeechSynthesisUtterance(currentItem.eng);
Â  Â  utterance.lang = 'en-US';
Â  Â  utterance.rate = 0.9; // Daha doÄŸal bir hÄ±z
Â  Â  utterance.pitch = 1;Â 
Â  Â  window.speechSynthesis.speak(utterance);
};
const settingsContainer = document.querySelector('#settings-modal .modal-content');
const darkModeHTML = `
<div style="display:flex; justify-content:space-between; align-items:center; padding:15px; background:#f8fafc; border-radius:18px; margin-bottom:20px">
Â  Â  <span style="font-weight:600">KaranlÄ±k Mod (Dark Mode)</span>
Â  Â  <label class="switch">
Â  Â  Â  Â  <input type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode(this.checked)">
Â  Â  Â  Â  <span class="slider"></span>
Â  Â  </label>
</div>
`;
settingsContainer.querySelector('button').insertAdjacentHTML('beforebegin', darkModeHTML);
const darkStyles = `
<style id="dark-mode-styles">
Â  Â  body.dark-mode { --bg: #0f172a; --text: #f8fafc; --card: #1e293b; }
Â  Â  body.dark-mode .container { background: var(--card); border-color: #334155; }
Â  Â  body.dark-mode input { background: #334155; border-color: #475569; color: white; }
Â  Â  body.dark-mode select { background: #334155; color: #cbd5e1; }
Â  Â  body.dark-mode .menu-bar { background: #334155; border-color: #475569; }
Â  Â  body.dark-mode .active-user { background: #1e293b; color: var(--primary-light); }
Â  Â  body.dark-mode #target-word { color: white; }
Â  Â  body.dark-mode #user-overlay { background: rgba(15, 23, 42, 0.95); }
Â  Â  body.dark-mode .user-card, body.dark-mode .modal-content { background: #1e293b; color: white; border-color: #334155; }
Â  Â  body.dark-mode .progress-row { background: #334155; border-color: #475569; }
Â  Â  body.dark-mode .tag-lvl { background: #312e81; color: #c7d2fe; }
Â  Â  body.dark-mode #settings-modal div[style*="background:#f8fafc"] { background: #334155 !important; }
</style>
`;
document.head.insertAdjacentHTML('beforeend', darkStyles);
let darkModeEnabled = localStorage.getItem('ox_dark_mode') === 'true';
document.getElementById('dark-mode-toggle').checked = darkModeEnabled;

function applyDarkMode(isDark) {
Â  Â  if (isDark) {
Â  Â  Â  Â  document.body.classList.add('dark-mode');
Â  Â  } else {
Â  Â  Â  Â  document.body.classList.remove('dark-mode');
Â  Â  }
}

function toggleDarkMode(isEnabled) {
Â  Â  darkModeEnabled = isEnabled;
Â  Â  localStorage.setItem('ox_dark_mode', isEnabled);
Â  Â  applyDarkMode(isEnabled);
}
applyDarkMode(darkModeEnabled);
const originalGetNextWord = getNextWord;
getNextWord = function() {
Â  Â  if (!filteredDict.length) return originalGetNextWord();

Â  Â  const now = Date.now();
Â  Â  let dueWords = filteredDict.filter(item => {
Â  Â  Â  Â  const data = srsData[item.eng];
Â  Â  Â  Â  if (!data) return true; // HiÃ§ gÃ¶rÃ¼lmemiÅŸ kelime
Â  Â  Â  Â  if (data.isMistake) return true; // HatalÄ± kelime
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Bir sonraki gÃ¶rÃ¼lme zamanÄ± gelmiÅŸ mi? (Default: 0)
Â  Â  Â  Â  return !data.nextReview || now >= data.nextReview;
Â  Â  });
Â  Â  if (dueWords.length === 0) {
Â  Â  Â  Â  dueWords = filteredDict;
Â  Â  }

Â  Â  // %20 ihtimalle hatalÄ± kelimelere Ã¶ncelik ver
Â  Â  const mistakes = dueWords.filter(i => srsData[i.eng]?.isMistake);
Â  Â  if (mistakes.length > 0 && Math.random() < 0.2) {
Â  Â  Â  Â  currentItem = mistakes[Math.floor(Math.random() * mistakes.length)];
Â  Â  } else {
Â  Â  Â  Â  currentItem = dueWords[Math.floor(Math.random() * dueWords.length)];
Â  Â  }

Â  Â  secondChanceActive = false;
Â  Â  renderWord();
};
const originalFinalizeRound = finalizeRound;
finalizeRound = function(isCorrect) {
Â  Â  if (!srsData[currentItem.eng]) {
Â  Â  Â  Â  srsData[currentItem.eng] = { level: 0, isMistake: false, nextReview: 0 };
Â  Â  }

Â  Â  const data = srsData[currentItem.eng];
Â  Â  const now = Date.now();

Â  Â  if (isCorrect) {
Â  Â  Â  Â  data.level++;
Â  Â  Â  Â  // Seviyeye gÃ¶re bekleme sÃ¼resi (Dakika bazlÄ± Ã¶rnek: 2^level * 10 dk)
Â  Â  Â  Â  // Profesyonel SRS: Seviye 1: 10dk, Seviye 2: 1 saat, Seviye 3: 5 saat, Seviye 4: 1 gÃ¼n...
Â  Â  Â  Â  const intervals = [0, 10, 60, 300, 1440, 4320, 10080]; // Dakika cinsinden
Â  Â  Â  Â  const waitMinutes = intervals[Math.min(data.level, intervals.length - 1)];
Â  Â  Â  Â  data.nextReview = now + (waitMinutes * 60000);
Â  Â  } else {
Â  Â  Â  Â  data.level = 0; // YanlÄ±ÅŸta baÅŸa dÃ¶n
Â  Â  Â  Â  data.nextReview = now; // Hemen tekrar sorulabilir
Â  Â  }

Â  Â  originalFinalizeRound(isCorrect);
};

console.log("ğŸš€ SRS AlgoritmasÄ± Aktif: Kelimeler artÄ±k Ã¶ÄŸrenme hÄ±zÄ±nÄ±za gÃ¶re gelecek.");

const statusRenderWord = renderWord;
renderWord = function() {
Â  Â  statusRenderWord(); // Orijinal render fonksiyonunu Ã§aÄŸÄ±r
Â  Â Â 
Â  Â  // Bilgi kutusunu oluÅŸtur veya gÃ¼ncelle
Â  Â  let statusBox = document.getElementById('srs-status');
Â  Â  if (!statusBox) {
Â  Â  Â  Â  statusBox = document.createElement('div');
Â  Â  Â  Â  statusBox.id = 'srs-status';
Â  Â  Â  Â  statusBox.style = "font-size: 0.65rem; font-weight: 800; color: var(--primary-light); margin-top: -5px; margin-bottom: 10px; text-align: center; text-transform: uppercase; letter-spacing: 1px;";
Â  Â  Â  Â  document.getElementById('tags-box').after(statusBox);
Â  Â  }

Â  Â  const data = srsData[currentItem.eng];
Â  Â  if (data && data.level > 0) {
Â  Â  Â  Â  const levelStars = "â­".repeat(Math.min(data.level, 5));
Â  Â  Â  Â  statusBox.innerText = `Ã–ÄŸrenme Seviyesi: ${levelStars}`;
Â  Â  } else {
Â  Â  Â  Â  statusBox.innerText = "YENÄ° KELÄ°ME âœ¨";
Â  Â  }
};
Â  Â // --- MOBÄ°L KLAVYE VE GÃ–RÃœNÃœM OPTÄ°MÄ°ZASYONU (GÄ°ZLEME KAPALI) ---

const inputGroup = document.querySelector('.input-group');
const userInput = document.getElementById('user-input');
const targetWordDiv = document.getElementById('target-word');

// 1. AkÄ±llÄ± Odaklanma: KullanÄ±cÄ± etkileÅŸimi sonrasÄ± klavye yÃ¶netimi
let hasInteracted = false;
document.addEventListener('touchstart', () => { hasInteracted = true; }, { once: true });

const wrapFocus = () => {
Â  Â  if (hasInteracted) {
Â  Â  Â  Â  setTimeout(() => { userInput.focus(); }, 100);
Â  Â  }
};

// 2. Dinamik Klavye Takibi (Visual Viewport)
if (window.visualViewport) {
Â  Â  window.visualViewport.addEventListener('resize', () => {
Â  Â  Â  Â  const viewport = window.visualViewport;
Â  Â  Â  Â  const offset = window.innerHeight - viewport.height;

Â  Â  Â  Â  if (offset > 150) { // Klavye aÃ§Ä±ldÄ±
Â  Â  Â  Â  Â  Â  document.body.classList.add('keyboard-active');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Buton grubunu klavyenin Ã¼zerine taÅŸÄ± (ElemanlarÄ± gizlemeden)
Â  Â  Â  Â  Â  Â  inputGroup.style.position = 'fixed';
Â  Â  Â  Â  Â  Â  inputGroup.style.bottom = `${offset + 5}px`;
Â  Â  Â  Â  Â  Â  inputGroup.style.left = '24px';
Â  Â  Â  Â  Â  Â  inputGroup.style.right = '24px';
Â  Â  Â  Â  Â  Â  inputGroup.style.zIndex = '1000';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Alan aÃ§mak iÃ§in sadece ana kelimeyi biraz kÃ¼Ã§Ã¼lt
Â  Â  Â  Â  Â  Â  targetWordDiv.style.fontSize = '2.4rem';
Â  Â  Â  Â  } else { // Klavye kapandÄ±
Â  Â  Â  Â  Â  Â  document.body.classList.remove('keyboard-active');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Eski haline dÃ¶ndÃ¼r
Â  Â  Â  Â  Â  Â  inputGroup.style.position = 'relative';
Â  Â  Â  Â  Â  Â  inputGroup.style.bottom = '0';
Â  Â  Â  Â  Â  Â  inputGroup.style.left = '0';
Â  Â  Â  Â  Â  Â  inputGroup.style.right = '0';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  targetWordDiv.style.fontSize = '3.2rem';
Â  Â  Â  Â  }
Â  Â  });
}

// Mevcut renderWord fonksiyonuna focus tetikleyiciyi ekle
const oldRender = renderWord;
renderWord = function() {
Â  Â  oldRender();
Â  Â  wrapFocus();
};

// CSS DÃ¼zenlemeleri (Gizleme kurallarÄ± kaldÄ±rÄ±ldÄ±)
const mobileStyle = document.createElement('style');
mobileStyle.innerHTML = `
Â  Â  .keyboard-active .container {
Â  Â  Â  Â  padding-bottom: 120px !important; /* Butonun altÄ±nda kalan alan iÃ§in boÅŸluk */
Â  Â  }
Â  Â  #user-input:focus {
Â  Â  Â  Â  font-size: 16px !important; /* iOS zoom korumasÄ± */
Â  Â  }
`;
document.head.appendChild(mobileStyle);
Â  Â Â 
</script>
</body>
</html>
